## バッチ名: 在庫警告通知バッチ

外部設計書

| ドキュメント名 | 作成日／更新日 | 版 | 作成者／更新者 |
|---|---|---|---|
| 外部設計書_バッチ設計（在庫警告通知） | 2025-04-26 | 1.0.0 | あなたのお名前 |

### 1. 前処理

#### 1.1. 権限チェック

・バッチ実行アカウントの権限をチェックする。  
・データベース接続権限を確認。

#### 1.2. パラメータ取得

・在庫警告通知処理に必要なパラメータを取得する。

| ＃ | パラメータ名 | 説明 |
|---|---|---|
| 1 | 実行日 | バッチ実行日（YYYY-MM-DD形式） |
| 2 | 警告レベル設定ファイル | 警告レベル設定CSVファイルパス |
| 3 | 通知先設定ファイル | 通知先メールアドレス設定ファイルパス |

### 2. チェック処理

#### 2.1. パラメータ妥当性チェック

・実行日のフォーマットを確認。
・警告レベル設定ファイルが存在することを確認。
・通知先設定ファイルが存在することを確認。

### 3. 業務処理

#### 3.1. 警告対象商品抽出

##### 3.1.1. 在庫数チェック

・全商品の現在在庫数を取得。
・商品カテゴリごとの警告レベル設定を取得。

##### 3.1.2. 警告レベル別商品抽出

・「危険」レベル：在庫数が設定値以下で在庫切れリスクが高い商品
・「注意」レベル：在庫数が設定値以下で発注を検討すべき商品
・「過剰」レベル：在庫数が設定値以上で過剰在庫の可能性がある商品

#### 3.2. 販売状況分析

##### 3.2.1. 直近販売データ取得

・過去30日間の販売数データを取得。

##### 3.2.2. 販売傾向分析

・日次平均販売数を計算。
・在庫切れ予測日数を計算（現在在庫数÷日次平均販売数）。

#### 3.3. 警告レポート作成

##### 3.3.1. CSVレポート生成

・警告レベル別商品リストをCSV形式で出力。
・ファイル名：在庫警告リスト_YYYYMMDD.csv
・項目：商品コード、商品名、カテゴリ、現在在庫数、警告レベル、在庫切れ予測日数など

##### 3.3.2. サマリーレポート生成

・警告レベル別の集計情報（商品数、カテゴリ別内訳など）。
・ファイル名：在庫警告サマリー_YYYYMMDD.pdf

#### 3.4. DB記録

##### 3.4.1. 警告履歴登録

・警告対象商品の情報をDB上の警告履歴テーブルに登録。
・日付、商品コード、警告レベル、在庫数、在庫切れ予測日数などを記録。

### 4. 後処理

#### 4.1. メール通知

・担当者へ警告情報をメール通知。
・レベル別の警告内容と対象商品数を本文に記載。
・CSVレポートとサマリーレポートを添付。

#### 4.2. 管理画面通知

・在庫管理画面上に警告情報を表示するためのフラグを設定。
・警告対象商品に対して管理画面上でマーキング。

#### 4.3. 処理結果ログ出力

・処理件数（危険レベル件数、注意レベル件数、過剰レベル件数）をログ出力。
・作成ファイルパス情報を出力。