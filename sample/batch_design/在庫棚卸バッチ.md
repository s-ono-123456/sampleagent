## バッチ名: 在庫棚卸バッチ

外部設計書

| ドキュメント名 | 作成日／更新日 | 版 | 作成者／更新者 |
|---|---|---|---|
| 外部設計書_バッチ設計（在庫棚卸） | 2025-04-26 | 1.0.0 | あなたのお名前 |

### 1. 前処理

#### 1.1. 権限チェック

・バッチ実行アカウントの権限をチェックする。  
・データベース接続権限を確認。

#### 1.2. パラメータ取得

・棚卸処理に必要なパラメータを取得する。

| ＃ | パラメータ名 | 説明 |
|---|---|---|
| 1 | 棚卸基準日 | 棚卸を実施する基準日（YYYY-MM-DD形式） |
| 2 | 実行アカウント | バッチ実行アカウント情報 |
| 3 | 出力パス | 棚卸表などの出力先パス |

### 2. チェック処理

#### 2.1. パラメータ妥当性チェック

・基準日のフォーマットを確認。
・出力パスが存在し、アクセス可能であることを確認。

### 3. 業務処理

#### 3.1. 在庫データ取得

##### 3.1.1. 在庫データ抽出

・全商品の現在の在庫数を取得。
・商品マスタから商品情報（商品コード、商品名、標準単価など）を取得。

##### 3.1.2. 過去の棚卸データ取得

・前回の棚卸データがあれば取得（比較用）。

#### 3.2. 棚卸表作成

##### 3.2.1. 在庫リスト作成

・商品ごとの在庫リストを作成。
・システム在庫数、実在庫数（初期値はシステム在庫数と同じ）、差異数（初期値は0）のカラムを用意。

##### 3.2.2. CSV出力

・棚卸表をCSV形式で出力。
・ファイル名：在庫棚卸表_YYYYMMDD.csv

#### 3.3. 棚卸マスタ登録

##### 3.3.1. トランザクション開始

・DB登録処理のトランザクション開始。

##### 3.3.2. 棚卸マスタ登録

・棚卸基準日、棚卸番号、実施者情報を登録。
・棚卸ステータスを「作成中」として登録。

##### 3.3.3. 棚卸明細登録

・全商品の棚卸対象データを登録。
・商品コード、システム在庫数、実在庫数（初期値）を登録。

##### 3.3.4. コミット

・エラーがなければトランザクションをコミット。

### 4. 後処理

#### 4.1. 担当者通知

・棚卸表の作成完了を担当者にメール通知。
・棚卸表のファイルパス、作業期限などを通知。

#### 4.2. 処理結果ログ出力

・処理件数（対象商品数、出力ファイル名）をログ出力。
・エラー詳細情報を出力。