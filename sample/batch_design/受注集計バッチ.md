## バッチ名: 受注集計バッチ

外部設計書

| ドキュメント名 | 作成日／更新日 | 版 | 作成者／更新者 |
|---|---|---|---|
| 外部設計書_バッチ設計（受注集計） | 2025-04-26 | 1.0.0 | あなたのお名前 |

### 1. 前処理

#### 1.1. 権限チェック

・バッチ実行アカウントの権限をチェックする。  
・データベース接続権限を確認。

#### 1.2. パラメータ取得

・集計対象期間の情報を取得する。

| ＃ | パラメータ名 | 説明 |
|---|---|---|
| 1 | 集計期間開始日 | 集計対象期間の開始日（YYYY-MM-DD形式） |
| 2 | 集計期間終了日 | 集計対象期間の終了日（YYYY-MM-DD形式） |
| 3 | レポート出力先 | 集計結果ファイルの出力先パス |

### 2. チェック処理

#### 2.1. パラメータ妥当性チェック

・日付パラメータのフォーマットチェック。
・開始日が終了日より前であることを確認。
・出力先パスが存在しアクセス可能か確認。

### 3. 業務処理

#### 3.1. 日次売上集計

##### 3.1.1. 対象データ集計

・対象期間内の受注データを日付単位で集計。
・日別の受注件数、金額、平均購入金額を算出。

##### 3.1.2. 集計結果出力

・日次売上集計結果をCSVファイルに出力。
・ファイル名：日次売上集計_YYYYMMDD-YYYYMMDD.csv

#### 3.2. 商品別売上集計

##### 3.2.1. 対象データ集計

・対象期間内の商品別売上データを集計。
・商品別の販売数量、売上金額、売上構成比を算出。

##### 3.2.2. 集計結果出力

・商品別売上集計結果をCSVファイルに出力。
・ファイル名：商品別売上集計_YYYYMMDD-YYYYMMDD.csv

#### 3.3. 顧客別売上集計

##### 3.3.1. 対象データ集計

・対象期間内の顧客別売上データを集計。
・顧客別の購入回数、購入金額、平均購入額を算出。

##### 3.3.2. 集計結果出力

・顧客別売上集計結果をCSVファイルに出力。
・ファイル名：顧客別売上集計_YYYYMMDD-YYYYMMDD.csv

#### 3.4. 集計情報DB登録

##### 3.4.1. トランザクション開始

・DB登録処理のトランザクション開始。

##### 3.4.2. 売上集計テーブル更新

・集計結果テーブルに日次、商品別、顧客別の集計結果を登録。
・既存データがある場合は更新、なければ新規登録。

##### 3.4.3. コミット

・エラーがなければトランザクションをコミット。

### 4. 後処理

#### 4.1. 集計レポート作成

・集計結果をPDF形式のレポートにまとめる。
・グラフ、表などを含む。
・ファイル名：受注集計レポート_YYYYMMDD-YYYYMMDD.pdf

#### 4.2. 関係者へのメール送信

・集計レポートを指定の関係者（営業部長、経営層など）にメール送信。
・概要説明と添付ファイルを含む。

#### 4.3. 処理結果ログ出力

・集計処理結果（処理時間、対象件数、作成ファイル）をログ出力。
・エラー詳細情報を出力。